<Project>
	<Import Project="Sdk.targets" Sdk="Microsoft.NET.Sdk" />
	<PropertyGroup>
		<NoStandardLib>true</NoStandardLib>
		<ImplicitUsings>disable</ImplicitUsings>
		<GenerateAssemblyInfo>false</GenerateAssemblyInfo>
		<GenerateTargetFrameworkAttribute>false</GenerateTargetFrameworkAttribute>
		<DisableImplicitFrameworkReferences>true</DisableImplicitFrameworkReferences>
		<Ext>dll</Ext>
    <NScriptToolSetPath Condition=" '$(NScriptToolSetPath)' == '' ">$(MSBuildThisFileDirectory)\..</NScriptToolSetPath>
    <PluginConfig Condition=" '$(PluginConfig)' == '' ">$(NScriptBinPath)/PluginConfig.xml</PluginConfig>
    <NScriptBinPath>$(NScriptToolSetPath)/tools/net6.0/</NScriptBinPath>
    <CscToolExe>$(NScriptBinPath)\csc.exe</CscToolExe>
    <NScriptExe>$(NScriptBinPath)/NScript.exe</NScriptExe>
	</PropertyGroup>

  <ItemGroup>
    <Reference Include="$(NScriptToolSetPath)/lib/*.dll">
      <HintPath>$(MSBuildThisFileDirectory)lib</HintPath>
    </Reference>
  </ItemGroup>

	<Target Name="AfterCompile" DependsOnTargets="$(CoreCompile)" > 
		<MsBuild
			Condition="$(GenerateJs) == True"
			Projects="$(MSBuildProjectFile)"
			Targets="ScriptGenerate" /> 
	</Target>

	<Target
		Name="ScriptGenerate"
		Inputs="$(BaseIntermediateOutputPath)$(Configuration)\$(AssemblyName).$(Ext);@(ReferencePath)"
		Outputs="$(JsOutputPath)$(AssemblyName).js"
		DependsOnTargets="$(CoreCompile)"
		Condition="$(GenerateJs) == True">

		<Message Text="Running NScript to produce $(OutputPath)$(AssemblyName).js."/>

		<PropertyGroup>
			<Refs>&quot;@(ReferencePath->'%(identity)','&quot;,&quot;')&quot;</Refs>
		</PropertyGroup>

		<ItemGroup>
			<ScriptGenerateOption Include="-outJs &quot;$(JsOutputPath)$(AssemblyName).js&quot;"/>
			<ScriptGenerateOption Include="-entryAssembly &quot;$(BaseIntermediateOutputPath)$(Configuration)\$(TargetFramework)\$(AssemblyName).$(Ext)&quot;"/>
			<ScriptGenerateOption Include="-references $(Refs)"/>
			<ScriptGenerateOption Include="-pluginConfig &quot;$(PluginConfig)&quot;" Condition="'$(PluginConfig)' != ''"/>
			<ScriptGenerateOption Include="-pluginHintPath &quot;$(NScriptBinPath);&quot;" Condition="'$(PluginConfig)' != ''"/>
			<ScriptGenerateOption Include="-referenceHintPath &quot;$(MsBuildThisFileDirectory)&quot;"/>
		</ItemGroup>

		<Exec Command="&quot;$(NScriptExe)&quot; @(ScriptGenerateOption->'%(Identity)', ' ')"/>

	</Target>

</Project>
